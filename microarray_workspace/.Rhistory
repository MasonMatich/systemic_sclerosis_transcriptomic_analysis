# Extract expression data for these genes
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- x$E[rownames(top_genes), ]
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
# Get Color Palette
royal1_colors <- wes_palette("Royal1", type = "discrete")
# Create color scheme for annotations
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "SSc" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Sex,
Group = metadata$Group,
row.names = rownames(heatmap_data)
)
# Select top DE genes (e.g., top 50 by adj.P.Val)
top_genes <- groupSSc[order(groupSSc$adj.P.Val), ][1:50, ]
# Extract expression data for these genes
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- x$E[rownames(top_genes), ]
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
# Get Color Palette
royal1_colors <- wes_palette("Royal1", type = "discrete")
# Create color scheme for annotations
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "SSc" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Sex,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
metadata$Sex
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = rownames(heatmap_data)
)
# Create heatmap with gene names
pheatmap(heatmap_data,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,  # Changed to TRUE
show_colnames = FALSE,
fontsize_row = 8,  # Adjust font size for readability
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = rownames(heatmap_data)
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
# Create heatmap with gene names
pheatmap(heatmap_data,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,  # Changed to TRUE
show_colnames = FALSE,
fontsize_row = 8,  # Adjust font size for readability
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
colnames(heatmap_data)
# Select top DE genes (e.g., top 50 by adj.P.Val)
top_genes <- groupSSc[order(groupSSc$adj.P.Val), ][1:50, ]
# Extract expression data for these genes
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- x$E[rownames(top_genes), ]
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
# Get Color Palette
royal1_colors <- wes_palette("Royal1", type = "discrete")
# Create color scheme for annotations
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "SSc" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
# Create heatmap with gene names
pheatmap(heatmap_data,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,  # Changed to TRUE
show_colnames = FALSE,
fontsize_row = 8,  # Adjust font size for readability
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
# Select top DE genes (e.g., top 50 by adj.P.Val)
top_genes <- groupSSc[order(groupSSc$adj.P.Val), ][1:50, ]
# Extract expression data for these genes
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- x$E[rownames(top_genes), ]
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
# Get Color Palette
royal1_colors <- wes_palette("Royal1", type = "discrete")
# Create color scheme for annotations
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "SSc" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group
)
# Create heatmap with gene names
pheatmap(heatmap_data,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,  # Changed to TRUE
show_colnames = FALSE,
fontsize_row = 8,  # Adjust font size for readability
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
x$E
# Extract expression data for these genes
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- x$E[rownames(top_genes), ] %>%
as.data.frame() %>%
mutate(Symbol = mapped_genes[rownames(y$E),1], .before = "GSM1145870")
# Extract expression data for these genes
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- y$E %>%
as.data.frame() %>%
mutate(Symbol = mapped_genes[rownames(y$E),1], .before = "GSM1145870")
heatmap_data
top_genes
# Extract expression data for these genes
heatmap_data <- heatmap_data[rownames(top_genes), ]
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_data)
)
colnames(heatmap_data)
metadata$Gender_Male
metadata$Group
colnames(heatmap_data)
rownames(heatmap_data)
heatmap_data$Symbol
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = heatmap_data$Symbol
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group
)
# Get Color Palette
royal1_colors <- wes_palette("Royal1", type = "discrete")
# Create color scheme for annotations
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "SSc" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group
)
# Create heatmap with gene names
pheatmap(heatmap_data,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,  # Changed to TRUE
show_colnames = FALSE,
fontsize_row = 8,  # Adjust font size for readability
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
print(heatmap_data)
heatmap_data <- y$E %>%
as.data.frame() %>%
mutate(Symbol = mapped_genes[rownames(y$E),1], .before = "GSM1145870")
# Select top DE genes (e.g., top 50 by adj.P.Val)
top_genes <- groupSSc[order(groupSSc$adj.P.Val), ][1:50, ]
# Extract expression data for these genes
heatmap_data <- heatmap_data[rownames(top_genes), ]
print(heatmap_data)
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- y$E %>%
as.data.frame() %>%
mutate(Symbol = mapped_genes[rownames(y$E),1], .before = "GSM1145870")
# Select top DE genes (e.g., top 50 by adj.P.Val)
top_genes <- groupSSc[order(groupSSc$adj.P.Val), ][1:50, ]
# Extract expression data for these genes
heatmap_data <- heatmap_data[rownames(top_genes), ]
print(heatmap_data)
# Remove the Symbol column and set it as rownames
heatmap_matrix <- heatmap_data %>%
select(-Symbol) %>%
as.matrix()
rownames(heatmap_matrix) <- heatmap_data$Symbol
# Prepare annotation colors with Royal1 palette
library(wesanderson)
royal1_colors <- wes_palette("Royal1", type = "discrete")
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "Treatment" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Sex,
Group = metadata$Group,
row.names = colnames(heatmap_matrix)
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_matrix)
)
# Create heatmap with gene names
library(pheatmap)
pheatmap(heatmap_matrix,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,
show_colnames = FALSE,
fontsize_row = 8,
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
# Match by the probe IDs (rownames of expr_matrix should match rownames of de_results)
heatmap_data <- y$E %>%
as.data.frame() %>%
mutate(Symbol = mapped_genes[rownames(y$E),1], .before = "GSM1145870")
# Select top DE genes (e.g., top 50 by adj.P.Val)
top_genes <- groupSSc[order(groupSSc$adj.P.Val), ][1:50, ]
# Extract expression data for these genes
heatmap_data <- heatmap_data[rownames(top_genes), ]
print(heatmap_data)
# Remove the Symbol column and set it as rownames
heatmap_matrix <- heatmap_data %>%
select(-Symbol) %>%
as.matrix()
rownames(heatmap_matrix) <- heatmap_data$Symbol
# Prepare annotation colors with Royal1 palette
royal1_colors <- wes_palette("Royal1", type = "discrete")
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "Treatment" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_matrix)
)
pheatmap(heatmap_matrix,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,
show_colnames = FALSE,
fontsize_row = 8,
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
ann_colors <- list(
Sex = c("Female" = royal1_colors[1], "Male" = royal1_colors[2]),
Group = c("Control" = royal1_colors[3], "SSc" = royal1_colors[4])
)
# Prepare annotation data frame
annotation_col <- data.frame(
Sex = metadata$Gender_Male,
Group = metadata$Group,
row.names = colnames(heatmap_matrix)
)
pheatmap(heatmap_matrix,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,
show_colnames = FALSE,
fontsize_row = 8,
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
ggsave("../figures/heatmap", plot = heatmap, width = 8, height = 12)
ggsave("../figures/heatmap.pdf", plot = heatmap, width = 8, height = 12)
heatmap <- pheatmap(heatmap_matrix,
annotation_col = annotation_col,
annotation_colors = ann_colors,
scale = "row",
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
show_rownames = TRUE,
show_colnames = FALSE,
fontsize_row = 8,
color = colorRampPalette(rev(brewer.pal(11, "RdBu")))(100),
main = "Top 50 Differentially Expressed Genes")
ggsave("../figures/heatmap.pdf", plot = heatmap, width = 8, height = 12)
ggsave("../figures/heatmap.pdf", plot = heatmap, width = 8, height = 10)
metadata
metadata
print(metadata$Gender_Male == "Female")
print(as.matrix(metadata[,c("GSM", "Group", "Gender_Male")]))
print(table(metadata$Group))
print(table(metadata$Gender_Male))
metadata
mapped_genes
grep("LEF1", mapped_genes$Symbol, value = T)
grep("LEF1", mapped_genes$Symbol)
GeneInteractionPlot("ILMN_1679185")
pdf("../figures/Top30_SSc_DEGs_andLEF1.pdf")
for (i in 1:30){
GeneInteractionPlot(rownames(groupSSc[i,]))
GeneInteractionPlot("ILMN_1679185")
}
dev.off()
GeneInteractionPlot <- function(probeID, titleAdd = ""){
d$Expr <- as.numeric(norm_expr_df[probeID, c(2:36)])
# Fit linear models for each sex
lm_female <- lm(Expr ~ Group_num, data = d[d$Sex == "Female", ])
lm_male <- lm(Expr ~ Group_num, data = d[d$Sex == "Male", ])
# Extract coefficients and p-values
female_slope <- coef(lm_female)[2]
female_p <- summary(lm_female)$coefficients[2, 4]
male_slope <- coef(lm_male)[2]
male_p <- summary(lm_male)$coefficients[2, 4]
# Create annotation text
annotation_text <- sprintf(
"Female: slope = %.3f, p = %.3g\nMale: slope = %.3f, p = %.3g",
female_slope, female_p, male_slope, male_p
)
# Plot
temp <- ggplot(d, aes(x = Group, y = Expr, color = Sex)) +
geom_jitter(width = 0.15, size = 3, alpha = 0.8) +
geom_smooth(
aes(x = Group_num, y = Expr, color = Sex, group = Sex),
method = "lm",
se = FALSE,
linewidth = 1
) +
scale_color_manual(values = c("Female" = "#E41A1C", "Male" = "#377EB8")) +
labs(title = paste0(mapped_genes[probeID, "Symbol"]," " ,titleAdd), x = "Group", y = "Expression") +
annotate("text", x = -Inf, y = Inf, label = annotation_text,
hjust = -0.1, vjust = 1.1, size = 3.5, color = "black") +
theme_bw()
print(temp)
}
GeneInteractionPlot("ILMN_1679185")
GeneInteractionPlotOld <- function(probeID, titleAdd = ""){
d$Expr <- as.numeric(norm_expr_df[probeID, c(2:36)])
# Plot
temp <- ggplot(d, aes(x = Group, y = Expr, color = Sex)) +
geom_jitter(width = 0.15, size = 3, alpha = 0.8) +
geom_smooth(
aes(x = Group_num, y = Expr, color = Sex, group = Sex),
method = "lm",
se = FALSE,
linewidth = 1
) +
scale_color_manual(values = c("Female" = "#E41A1C", "Male" = "#377EB8")) +
labs(title = paste0(mapped_genes[probeID, "Symbol"]," " ,titleAdd), x = "Group", y = "Expression") +
theme_bw()
print(temp)
}
GeneInteractionPlot <- function(probeID, titleAdd = ""){
d$Expr <- as.numeric(norm_expr_df[probeID, c(2:36)])
# Fit linear models for each sex
lm_female <- lm(Expr ~ Group_num, data = d[d$Sex == "Female", ])
lm_male <- lm(Expr ~ Group_num, data = d[d$Sex == "Male", ])
# Extract coefficients and p-values
female_slope <- coef(lm_female)[2]
female_p <- summary(lm_female)$coefficients[2, 4]
male_slope <- coef(lm_male)[2]
male_p <- summary(lm_male)$coefficients[2, 4]
# Create annotation text for each sex
female_text <- sprintf("Female: slope = %.3f, p = %.3g", female_slope, female_p)
male_text <- sprintf("Male: slope = %.3f, p = %.3g", male_slope, male_p)
# Plot
temp <- ggplot(d, aes(x = Group, y = Expr, color = Sex)) +
geom_jitter(width = 0.15, size = 3, alpha = 0.8) +
geom_smooth(
aes(x = Group_num, y = Expr, color = Sex, group = Sex),
method = "lm",
se = FALSE,
linewidth = 1
) +
scale_color_manual(values = c("Female" = "#E41A1C", "Male" = "#377EB8")) +
labs(title = paste0(mapped_genes[probeID, "Symbol"]," " ,titleAdd), x = "Group", y = "Expression") +
annotate("text", x = -Inf, y = Inf, label = female_text,
hjust = -0.1, vjust = 2.2, size = 3.5, color = "#E41A1C") +
annotate("text", x = -Inf, y = Inf, label = male_text,
hjust = -0.1, vjust = 1.1, size = 3.5, color = "#377EB8") +
theme_bw()
print(temp)
}
pdf("../figures/Top30_SSc_DEGs_andLEF1.pdf")
for (i in 1:30){
GeneInteractionPlot(rownames(groupSSc[i,]))
}
dev.off()
inter
# Results for SSc vs Control in FEMALES only
inter <- topTable(
fit,
coef = "groupSSc:sexMale",
number = Inf
)
inter
# Match ProbeID to Symbol
inter <- inter %>%
mutate(Symbol = mapped_genes[rownames(inter),1], .before = "logFC")
inter
# [1] "AGR3"
GeneInteractionPlot("ILMN_2319913")
# [1] "AGR3"
GeneInteractionPlot("ILMN_1772163")
# [1] "AGR3"
GeneInteractionPlot("ILMN_2377385")
# [1] "AGR3"
GeneInteractionPlot("ILMN_2319913")
inter
grep("DGKA", groupSSc$Symbol)
groupSSc
pdf("../figures/DGKA.pdf")
GeneInteractionPlot("ILMN_2319913")
dev.off
GeneInteractionPlot("ILMN_2319913")
pdf("../figures/DGKA.pdf")
GeneInteractionPlot("ILMN_2319913")
dev.off()
dev.off()
pdf("../figures/DGKA.pdf")
GeneInteractionPlot("ILMN_2319913")
dev.off()
# targeted ones
pdf("../figures/BulkRNAseq_overlapp_genes.pdf")
# [1] "AGR3"
GeneInteractionPlot("ILMN_2050246", "Probe ILMN_1789507")
# targeted ones
pdf("../figures/BulkRNAseq_overlapp_genes.pdf")
# [1] "AGR3"
GeneInteractionPlot("ILMN_1728787", "Probe ILMN_1728787")
# [1] "COL11A1"
GeneInteractionPlot("ILMN_1789507", "Probe ILMN_1789507")
GeneInteractionPlot("ILMN_2392803", "Probe ILMN_2392803")
dev.off()
